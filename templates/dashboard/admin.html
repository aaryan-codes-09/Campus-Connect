{% extends 'base.html' %}
{% block title %}Admin Dashboard – CampusConnect{% endblock %}
{% block page_title %}Admin Panel{% endblock %}
{% block content %}
<div class="page-header d-flex justify-content-between align-items-start flex-wrap gap-3">
  <div><div class="page-header-title">Admin Dashboard <span style="font-size:1rem;opacity:.6">⚙️</span></div><div class="page-header-sub"><span class="badge-pill badge-purple">Administrator</span></div></div>
  <div class="d-flex gap-2 flex-wrap">
    <a href="/admin/add-user" class="btn btn-teal btn-sm"><i class="fas fa-user-plus me-2"></i>Add User</a>
    <a href="/admin/users" class="btn btn-ghost btn-sm"><i class="fas fa-users me-2"></i>Manage Users</a>
  </div>
</div>
<div class="page-content">
  <div class="row g-3 mb-4">
    {% for icon,label,val,col in [('fa-users','Total Users',stats.users,'teal'),('fa-graduation-cap','Students',stats.students,'amber'),('fa-chalkboard-teacher','Teachers',stats.teachers,'coral'),('fa-calendar-star','Events',stats.events,'purple'),('fa-images','Memories',stats.memories,'blue'),('fa-hourglass-half','Pending Approvals',stats.pending,'amber')] %}
    <div class="col-6 col-md-4 col-lg-2">
      <div class="stat-card" style="flex-direction:column;align-items:flex-start;gap:8px">
        <div class="stat-icon stat-icon-{{ col }}"><i class="fas {{ icon }}"></i></div>
        <div><div class="stat-num" style="font-size:1.5rem">{{ val }}</div><div class="stat-label">{{ label }}</div></div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="row g-4">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header"><div class="card-header-title"><i class="fas fa-users-cog"></i>Recent Users</div><a href="/admin/users" class="btn btn-ghost btn-sm">Manage All</a></div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead><tr><th>User</th><th>Email</th><th>Role</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>
              {% for u in recent_users %}
              <tr>
                <td><div style="display:flex;align-items:center;gap:8px"><div class="avatar {{ 'avatar-amber' if u.role=='teacher' else 'avatar-coral' if u.role=='organizer' else 'avatar-purple' if u.role=='admin' else 'avatar-teal' }}" style="width:28px;height:28px;font-size:.72rem;flex-shrink:0">{{ u.full_name[0] }}</div><span style="font-weight:600;font-size:.85rem">{{ u.full_name[:20] }}</span></div></td>
                <td><span style="font-size:.78rem;color:var(--c-muted)">{{ u.email[:25] }}</span></td>
                <td><span class="badge-pill badge-muted">{{ u.role|title }}</span></td>
                <td><span class="badge-pill {{ 'badge-teal' if u.is_active else 'badge-coral' }}">{{ 'Active' if u.is_active else 'Off' }}</span></td>
                <td>
                  <form method="POST" action="/admin/users/{{ u.id }}/action" style="display:inline">
                    <input type="hidden" name="action" value="toggle">
                    <button type="submit" class="btn btn-sm {{ 'btn-danger-soft' if u.is_active else 'btn-success-soft' }}">{{ 'Disable' if u.is_active else 'Enable' }}</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card mb-4">
        <div class="card-header"><div class="card-header-title"><i class="fas fa-bolt"></i>Quick Actions</div></div>
        <div class="card-body d-flex flex-column gap-2">
          <a href="/admin/add-user" class="btn btn-teal w-100 text-start"><i class="fas fa-user-plus me-2"></i>Add Teacher / Organizer</a>
          <a href="/admin/users" class="btn btn-ghost w-100 text-start"><i class="fas fa-users-cog me-2"></i>Manage All Users</a>
          <a href="/events/create" class="btn btn-ghost w-100 text-start"><i class="fas fa-calendar-plus me-2"></i>Create Event</a>
          <a href="/timetable/manage" class="btn btn-ghost w-100 text-start"><i class="fas fa-edit me-2"></i>Manage Timetable</a>
          <a href="/notices/create" class="btn btn-ghost w-100 text-start"><i class="fas fa-bullhorn me-2"></i>Post Notice</a>
          <a href="/memories/upload" class="btn btn-ghost w-100 text-start"><i class="fas fa-upload me-2"></i>Upload Memories</a>
          <a href="/api/stats" target="_blank" class="btn btn-ghost w-100 text-start"><i class="fas fa-chart-bar me-2"></i>API Stats</a>
        </div>
      </div>

      <!-- My Info -->
      <div class="card" style="color : white">
        <div class="card-header"><div class="card-header-title"><i class="fas fa-info-circle"></i>My Info</div></div>
        <div class="card-body" style="font-size:.85rem">
          <div style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between"><span style="color:var(--c-muted)">Name</span><strong style="text-align:right;max-width:60%">{{ current_user.full_name }}</strong></div>
            <div class="divider" style="margin:0"></div>
            <div style="display:flex;justify-content:space-between"><span style="color:var(--c-muted)">Role</span><strong><span class="badge-pill badge-purple">Administrator</span></strong></div>
            <div class="divider" style="margin:0"></div>
            <div style="display:flex;justify-content:space-between"><span style="color:var(--c-muted)">Email</span><strong style="font-size:.8rem;text-align:right;max-width:60%">{{ current_user.email }}</strong></div>
          </div>
          <a href="/profile/edit" class="btn btn-ghost btn-sm w-100 mt-3">Edit Profile</a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
