{% extends 'base.html' %}
{% block title %}CampusConnect – ISBM College of Engineering, Pune{% endblock %}
{% block content %}

<!-- Hero -->
<section class="hero-gradient" style="padding:70px 0 50px">
  <div class="container-fluid px-4">
    <div class="row align-items-center g-4">
      <div class="col-lg-6">
        <div class="d-flex gap-2 mb-4 flex-wrap">
          <span class="badge-pill badge-teal"><i class="fas fa-map-marker-alt me-1"></i>Pune, MH</span>
          <span class="badge-pill badge-amber"><i class="fas fa-award me-1"></i>NBA Accredited</span>
          <span class="badge-pill badge-muted"><i class="fas fa-university me-1"></i>Est. 2003</span>
        </div>
        <h1 style="font-size:3rem;font-weight:800;line-height:1.15;margin-bottom:1rem">
          Your Digital<br><span class="text-teal">Campus Hub</span>
        </h1>
        <p style="color:var(--c-muted);font-size:1rem;line-height:1.7;margin-bottom:2rem;max-width:500px">
          Connect, learn, and celebrate at ISBM College of Engineering. Events, attendance, memories, notices — all in one place.
        </p>
        <div class="d-flex gap-3 flex-wrap">
          {% if not current_user %}
          <a href="/register" class="btn btn-teal btn-lg"><i class="fas fa-rocket me-2"></i>Get Started</a>
          <a href="/login" class="btn btn-ghost btn-lg">Login <i class="fas fa-arrow-right ms-2"></i></a>
          {% else %}
          <a href="/dashboard" class="btn btn-teal btn-lg"><i class="fas fa-th-large me-2"></i>Dashboard</a>
          <a href="/events" class="btn btn-ghost btn-lg">View Events</a>
          {% endif %}
        </div>
      </div>
      <div class="col-lg-6">
        <div class="row g-3">
          {% set items = [('fa-users','Students',stats.students|string + '+','teal'),('fa-calendar-star','Events',stats.events|string,'amber'),('fa-building','Departments',stats.departments|string,'coral'),('fa-images','Memories',stats.memories|string,'purple')] %}
          {% for icon,label,val,col in items %}
          <div class="col-6">
            <div class="stat-card">
              <div class="stat-icon stat-icon-{{ col }}"><i class="fas {{ icon }}"></i></div>
              <div><div class="stat-num">{{ val }}</div><div class="stat-label">{{ label }}</div></div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Dept pills -->
<div style="background:var(--c-surface);border-bottom:1px solid var(--c-border);padding:14px 0;overflow-x:auto">
  <div class="container-fluid px-4 d-flex gap-2 flex-nowrap">
    {% for d in depts %}
    <a href="/departments" class="badge-pill badge-muted" style="white-space:nowrap;cursor:pointer">
      <i class="fas fa-microchip me-1"></i>{{ d.code }}
    </a>
    {% endfor %}
  </div>
</div>

<div class="container-fluid px-4 py-5">
  <div class="row g-4">

    <!-- Upcoming Events -->
    <div class="col-lg-8">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <div class="section-label mb-1">What's On</div>
          <h2 style="font-size:1.3rem;font-weight:700;margin:0">Upcoming Events</h2>
        </div>
        <a href="/events" class="btn btn-ghost btn-sm">View All <i class="fas fa-arrow-right ms-1"></i></a>
      </div>
      <div class="row g-3">
        {% for ev in events %}
        <div class="col-md-6">
          <div class="event-card h-100">
            <div class="position-relative">
              {% if ev.banner_image %}
              <img src="/static/uploads/events/{{ ev.banner_image }}" class="event-card-img" alt="{{ ev.title }}">
              {% else %}
              <div class="event-card-placeholder" style="background:{% if ev.event_type=='technical' %}linear-gradient(135deg,#0d2035,#1a4080){% elif ev.event_type=='cultural' %}linear-gradient(135deg,#2d0a3a,#6d1a7e){% elif ev.event_type=='sports' %}linear-gradient(135deg,#0a2d1a,#1a6b35){% else %}linear-gradient(135deg,#2d1a00,#805020){% endif %}">
                <i class="fas fa-{{ 'code' if ev.event_type=='technical' else 'music' if ev.event_type=='cultural' else 'trophy' if ev.event_type=='sports' else 'tools' if ev.event_type=='workshop' else 'graduation-cap' }}" style="color:rgba(255,255,255,.4)"></i>
              </div>
              {% endif %}
              <div style="position:absolute;top:10px;left:10px">
                <span class="badge-pill {% if ev.event_type=='technical' %}badge-blue{% elif ev.event_type=='cultural' %}badge-purple{% elif ev.event_type=='sports' %}badge-teal{% elif ev.event_type=='workshop' %}badge-amber{% else %}badge-muted{% endif %}">{{ ev.event_type|title }}</span>
              </div>
            </div>
            <div class="event-card-body">
              <div class="fw-600 mb-1" style="font-size:.9rem">{{ ev.title }}</div>
              <div style="color:var(--c-muted);font-size:.8rem;line-height:1.5">{{ (ev.description or '')[:80] }}...</div>
              <div class="event-card-meta">
                <span><i class="fas fa-calendar"></i>{{ ev.event_date }}</span>
                <span><i class="fas fa-map-marker-alt"></i>{{ (ev.venue or '')[:20] }}</span>
                <span><i class="fas fa-users"></i>{{ ev.rc }} registered</span>
              </div>
              <div class="mt-3"><a href="/events/{{ ev.id }}" class="btn btn-ghost btn-sm w-100">View Details</a></div>
            </div>
          </div>
        </div>
        {% else %}
        <div class="col-12"><div class="alert alert-info">No upcoming events right now. Check back soon!</div></div>
        {% endfor %}
      </div>
    </div>

    <!-- Notices -->
    <div class="col-lg-4">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <div class="section-label mb-1">Announcements</div>
          <h2 style="font-size:1.3rem;font-weight:700;margin:0">Notice Board</h2>
        </div>
        <a href="/notices" class="btn btn-ghost btn-sm">All</a>
      </div>
      <div class="d-flex flex-column gap-3">
        {% for n in notices %}
        <div class="notice-item {{ 'important' if n.is_important else n.category }}">
          <div class="d-flex gap-2 mb-1">
            {% if n.is_important %}<span class="badge-pill badge-coral" style="font-size:.65rem">IMPORTANT</span>{% endif %}
            <span class="badge-pill badge-muted" style="font-size:.65rem">{{ n.category|title }}</span>
          </div>
          <div class="notice-item-title">{{ n.title }}</div>
          <div class="notice-item-meta">
            <span><i class="fas fa-user me-1"></i>{{ n.author_name }}</span>
            <span><i class="fas fa-clock me-1"></i>{{ n.created_at[:10] }}</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Memories Preview -->
  {% if memories %}
  <div class="mt-5">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div><div class="section-label mb-1">Gallery</div><h2 style="font-size:1.3rem;font-weight:700;margin:0">Event Memories</h2></div>
      <a href="/memories" class="btn btn-ghost btn-sm">View All <i class="fas fa-arrow-right ms-1"></i></a>
    </div>
    <div class="memory-grid">
      {% for m in memories %}
      <div class="memory-item">
        <img src="/static/uploads/memories/{{ m.image_path }}" alt="memory" onerror="this.src='https://via.placeholder.com/300x220/1a2740/7a95b8?text=Photo'">
        <div class="memory-overlay">
          <div style="font-weight:600;font-size:.82rem">{{ m.title or 'Campus Memory' }}</div>
          <div style="font-size:.72rem;opacity:.8"><i class="fas fa-heart me-1"></i>{{ m.likes }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- CTA -->
  {% if not current_user %}
  <div style="background:linear-gradient(135deg,rgba(0,200,160,.1),rgba(0,137,160,.1));border:1px solid rgba(0,200,160,.2);border-radius:var(--r);padding:40px;text-align:center;margin-top:48px">
    <h2 style="font-weight:800;font-size:1.8rem;margin-bottom:.5rem">Join CampusConnect</h2>
    <p style="color:var(--c-muted);margin-bottom:1.5rem">Register as a student to access events, timetable, attendance, and more.</p>
    <div class="d-flex gap-3 justify-content-center flex-wrap">
      <a href="/register" class="btn btn-teal btn-lg">Create Account</a>
      <a href="/login" class="btn btn-ghost btn-lg">Login</a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
