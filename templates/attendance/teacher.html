{% extends 'base.html' %}
{% block title %}QR Attendance â€“ CampusConnect{% endblock %}
{% block page_title %}QR Attendance{% endblock %}
{% block extra_css %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
{% endblock %}
{% block content %}
<div class="page-header d-flex justify-content-between align-items-start flex-wrap gap-3">
  <div><div class="page-header-title"><i class="fas fa-qrcode me-2 text-teal"></i>QR Attendance Manager</div><div class="page-header-sub">Create sessions and track student attendance in real-time</div></div>
  <a href="/attendance/create" class="btn btn-teal"><i class="fas fa-plus me-2"></i>New Session</a>
</div>
<div class="page-content">
  <div class="row g-4">
    <div class="col-lg-7">
      <div class="card mb-4">
        <div class="card-header"><div class="card-header-title"><i class="fas fa-history"></i>My Sessions</div></div>
        <div class="card-body p-0">
          {% if sessions %}
          <table class="table mb-0">
            <thead><tr><th>Subject</th><th>Dept</th><th>Date</th><th>Present</th><th>Status</th><th>Action</th></tr></thead>
            <tbody>
              {% for s in sessions %}
              <tr>
                <td style="font-weight:600">{{ s.subject }}</td>
                <td><span style="font-size:.8rem;color:var(--c-muted)">{{ (s.department or '')[:10] }} {{ s.year }}</span></td>
                <td><span style="font-size:.8rem">{{ s.date }}</span></td>
                <td><span style="font-weight:600;color:var(--c-teal)">{{ s.present_count or 0 }}</span></td>
                <td>
                  {% if s.is_active %}
                  <span class="badge-pill badge-teal" style="display:flex;align-items:center;gap:4px;width:fit-content"><span class="att-pulse"></span>LIVE</span>
                  {% else %}
                  <span class="badge-pill badge-muted">Closed</span>
                  {% endif %}
                </td>
                <td><a href="/attendance/session/{{ s.id }}" class="btn btn-ghost btn-sm">View</a></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div style="padding:32px;text-align:center;color:var(--c-muted)">
            <i class="fas fa-qrcode" style="font-size:2.5rem;opacity:.3;margin-bottom:12px;display:block"></i>
            No sessions yet. Create your first QR session!
            <div class="mt-3"><a href="/attendance/create" class="btn btn-teal btn-sm">Create Session</a></div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-lg-5">
      <!-- Student Attendance summary -->
      <div class="card">
        <div class="card-header"><div class="card-header-title"><i class="fas fa-users"></i>Students Overview</div></div>
        <div class="card-body p-0" style="max-height:420px;overflow-y:auto">
          {% if students %}
          <table class="table mb-0">
            <thead><tr><th>Student</th><th>Year</th><th>Attended</th></tr></thead>
            <tbody>
              {% for s in students %}
              <tr>
                <td>
                  <div style="font-weight:600;font-size:.83rem">{{ s.full_name[:22] }}</div>
                  <div style="font-size:.72rem;color:var(--c-muted)">{{ s.roll_number or 'N/A' }}</div>
                </td>
                <td><span class="badge-pill badge-muted">{{ s.year }}</span></td>
                <td>
                  <span style="font-weight:700;color:var(--c-teal)">{{ s.att_count }}</span>
                  <span style="color:var(--c-muted);font-size:.75rem"> sessions</span>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div style="padding:20px;text-align:center;color:var(--c-muted);font-size:.85rem">No students in your department.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
