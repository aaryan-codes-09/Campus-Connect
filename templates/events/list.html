{% extends 'base.html' %}
{% block title %}Events â€“ CampusConnect{% endblock %}
{% block page_title %}Campus Events{% endblock %}
{% block content %}
<div class="page-header d-flex justify-content-between align-items-start flex-wrap gap-3">
  <div><div class="page-header-title"><i class="fas fa-calendar-star me-2 text-teal"></i>Campus Events</div><div class="page-header-sub">Discover and register for events at ISBM College</div></div>
  {% if current_user and current_user.role in ('organizer','admin') %}
  <a href="/events/create" class="btn btn-teal"><i class="fas fa-plus me-2"></i>Create Event</a>
  {% endif %}
</div>
<div class="page-content" style="padding-top:0">
  <!-- Filters -->
  <div class="card mb-4" style="padding:16px 18px">
    <form method="GET" class="row g-2 align-items-end">
      <div class="col-md-3"><input type="text" name="q" value="{{ search }}" class="form-control" placeholder="ðŸ” Search events..."></div>
      <div class="col-md-2">
        <select name="dept" class="form-select">
          <option value="">All Depts</option>
          {% for d in depts %}<option value="{{ d.name }}" {% if dept_filter==d.name %}selected{% endif %}>{{ d.code }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <select name="type" class="form-select">
          <option value="">All Types</option>
          {% for t in ['technical','cultural','sports','workshop','academic'] %}<option value="{{ t }}" {% if type_filter==t %}selected{% endif %}>{{ t|title }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <select name="status" class="form-select">
          <option value="">All Status</option>
          {% for s in ['upcoming','completed'] %}<option value="{{ s }}" {% if status_filter==s %}selected{% endif %}>{{ s|title }}</option>{% endfor %}
        </select>
      </div>
      <div class="col-md-2"><button type="submit" class="btn btn-teal w-100">Filter</button></div>
      <div class="col-md-1"><a href="/events" class="btn btn-ghost w-100">Clear</a></div>
    </form>
  </div>

  <div class="row g-3">
    {% for ev in events %}
    <div class="col-md-6 col-lg-4">
      <div class="event-card h-100">
        <div style="position:relative">
          {% if ev.banner_image %}<img src="/static/uploads/events/{{ ev.banner_image }}" class="event-card-img" alt="{{ ev.title }}">
          {% else %}
          <div class="event-card-placeholder" style="background:{% if ev.event_type=='technical' %}linear-gradient(135deg,#0d2035,#1a4080){% elif ev.event_type=='cultural' %}linear-gradient(135deg,#2d0a3a,#6d1a7e){% elif ev.event_type=='sports' %}linear-gradient(135deg,#0a2d1a,#1a6b35){% else %}linear-gradient(135deg,#2d1a00,#805020){% endif %}">
            <i class="fas fa-{{ 'code' if ev.event_type=='technical' else 'music' if ev.event_type=='cultural' else 'trophy' if ev.event_type=='sports' else 'tools' if ev.event_type=='workshop' else 'graduation-cap' }}" style="color:rgba(255,255,255,.35)"></i>
          </div>{% endif %}
          <div style="position:absolute;top:10px;left:10px"><span class="badge-pill {% if ev.event_type=='technical' %}badge-blue{% elif ev.event_type=='cultural' %}badge-purple{% elif ev.event_type=='sports' %}badge-teal{% elif ev.event_type=='workshop' %}badge-amber{% else %}badge-muted{% endif %}">{{ ev.event_type|title }}</span></div>
          <div style="position:absolute;top:10px;right:10px"><span class="badge-pill {{ 'badge-teal' if ev.status=='upcoming' else 'badge-muted' }}">{{ ev.status|title }}</span></div>
        </div>
        <div class="event-card-body">
          <div style="font-weight:700;font-size:.92rem;margin-bottom:6px">{{ ev.title }}</div>
          <div style="color:var(--c-muted);font-size:.8rem;line-height:1.5;margin-bottom:8px">{{ (ev.description or '')[:90] }}...</div>
          <div class="event-card-meta">
            <span><i class="fas fa-calendar"></i>{{ ev.event_date }}</span>
            <span><i class="fas fa-clock"></i>{{ ev.event_time or 'TBD' }}</span>
            <span><i class="fas fa-map-marker-alt"></i>{{ (ev.venue or '')[:18] }}</span>
            <span><i class="fas fa-users"></i>{{ ev.rc }} registered</span>
          </div>
          <div class="mt-3"><a href="/events/{{ ev.id }}" class="btn btn-ghost btn-sm w-100">View Details</a></div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12" style="padding:48px;text-align:center;color:var(--c-muted)">
      <i class="fas fa-calendar-times" style="font-size:3rem;opacity:.3;margin-bottom:16px;display:block"></i>
      <h5>No events found.</h5>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
